---
title: "Predictions on Exercise Form - using practical machine learning"
author: "Menaka Kannan"
date: "Sunday, March 22, 2015"
output: html_document
---

#Synopsis
This report focuses on data gathered from a study conducted evaluating exercise 
form through the use of electronic devices which attach to the body. Devices
such as these have grown in popularity in recent years, as they allow users to
track the extent of their workout. This study focuses particularly on the 
ability of users to track their form. 

The original data for this report can be found at: 
http://groupware.les.inf.puc-rio.br/har. The data was obtained by attaching 
sensors (inertial measurement units) and weights to participants to measure the 
motion as exercises were performed. Each participant was instructed to perform 
a given exercise five different ways (one using proper form and four using 
improper form.

In the final data set, each record consists of measurements obtained per person
per exercise form in short span of time (0.5 - 2.5 seconds).

This report uses the data to create a prediction model to detect the variation 
of the exercise being performed based on collected data.

##Preparing the data

###Loading and Pre-processing
```{r loading, echo=TRUE, cache=TRUE, results='hide', eval=T}
setwd("F:/Data_Science_Coursera/Practical_Machine_Learning")
library(ggplot2)
library(lattice)
library(knitr)
library(caret)
library(randomForest)

download.file(url = "http://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv", destfile = "pml-training.csv")
download.file(url = "http://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv", destfile = "pml-testing.csv")
    
data <- read.csv("pml-training.csv")
dim(data)
## [1] 19622   160
summary(data$classe)
##    A    B    C    D    E 
## 5580 3797 3422 3216 3607
```

There are 19622 records with 160 variables. Prediction will be conducted on the 
classe variable, and the data will be split up between the five classes.

###Processing and Transformation
```{r processing, echo=TRUE, cache=TRUE, results='hide', eval=T}
set.seed(0)
inTrain = createDataPartition(y=data$classe, p=0.7, list=FALSE)
training = data[inTrain,]
testing = data[-inTrain,]
dim(training)
## [1] 13737   160
```
There are currently 159 variables available to use for training the model.
```{r processing2, echo=TRUE, cache=TRUE, results='hide', eval=T}
na_test = sapply(training, function(x) {sum(is.na(x))})
table(na_test)
## na_test
##     0 13460 
##    60   100
```
There are 100 columns with almost all missing values; these are removed.
```{r processing3, echo=TRUE, cache=TRUE, results='hide', eval=T}
bad_columns = names(na_test[na_test==13460])
training = training[, !names(training) %in% bad_columns]
str(training)

## 'data.frame':        13737 obs. of  60 variables:
##  $ X                   : int  2 3 4 5 7 8 9 10 11 12 ...
##  $ user_name           : Factor w/ 6 levels "adelmo","carlitos",..: 2 2 2 2 2 2 2 2 2 2 ...
##  $ raw_timestamp_part_1: int  1323084231 1323084231 1323084232 1323084232 1323084232 1323084232 1323084232 1323084232 1323084232 1323084232 ...
##  $ raw_timestamp_part_2: int  808298 820366 120339 196328 368296 440390 484323 484434 500302 528316 ...
##  $ cvtd_timestamp      : Factor w/ 20 levels "02/12/2011 13:32",..: 9 9 9 9 9 9 9 9 9 9 ...
##  $ new_window          : Factor w/ 2 levels "no","yes": 1 1 1 1 1 1 1 1 1 1 ...
##  $ num_window          : int  11 11 12 12 12 12 12 12 12 12 ...
##  $ roll_belt           : num  1.41 1.42 1.48 1.48 1.42 1.42 1.43 1.45 1.45 1.43 ...
##  $ pitch_belt          : num  8.07 8.07 8.05 8.07 8.09 8.13 8.16 8.17 8.18 8.18 ...
##  $ yaw_belt            : num  -94.4 -94.4 -94.4 -94.4 -94.4 -94.4 -94.4 -94.4 -94.4 -94.4 ...
##  $ total_accel_belt    : int  3 3 3 3 3 3 3 3 3 3 ...
##  $ gyros_belt_x        : num  0.02 0 0.02 0.02 0.02 0.02 0.02 0.03 0.03 0.02 ...
##  $ gyros_belt_y        : num  0 0 0 0.02 0 0 0 0 0 0 ...
##  $ gyros_belt_z        : num  -0.02 -0.02 -0.03 -0.02 -0.02 -0.02 -0.02 0 -0.02 -0.02 ...
##  $ accel_belt_x        : int  -22 -20 -22 -21 -22 -22 -20 -21 -21 -22 ...
##  $ accel_belt_y        : int  4 5 3 2 3 4 2 4 2 2 ...
##  $ accel_belt_z        : int  22 23 21 24 21 21 24 22 23 23 ...
##  $ magnet_belt_x       : int  -7 -2 -6 -6 -4 -2 1 -3 -5 -2 ...
##  $ magnet_belt_y       : int  608 600 604 600 599 603 602 609 596 602 ...
##  $ magnet_belt_z       : int  -311 -305 -310 -302 -311 -313 -312 -308 -317 -319 ...
##  $ roll_arm            : num  -128 -128 -128 -128 -128 -128 -128 -128 -128 -128 ...
##  $ pitch_arm           : num  22.5 22.5 22.1 22.1 21.9 21.8 21.7 21.6 21.5 21.5 ...
##  $ yaw_arm             : num  -161 -161 -161 -161 -161 -161 -161 -161 -161 -161 ...
##  $ total_accel_arm     : int  34 34 34 34 34 34 34 34 34 34 ...
##  $ gyros_arm_x         : num  0.02 0.02 0.02 0 0 0.02 0.02 0.02 0.02 0.02 ...
##  $ gyros_arm_y         : num  -0.02 -0.02 -0.03 -0.03 -0.03 -0.02 -0.03 -0.03 -0.03 -0.03 ...
##  $ gyros_arm_z         : num  -0.02 -0.02 0.02 0 0 0 -0.02 -0.02 0 0 ...
##  $ accel_arm_x         : int  -290 -289 -289 -289 -289 -289 -288 -288 -290 -288 ...
##  $ accel_arm_y         : int  110 110 111 111 111 111 109 110 110 111 ...
##  $ accel_arm_z         : int  -125 -126 -123 -123 -125 -124 -122 -124 -123 -123 ...
##  $ magnet_arm_x        : int  -369 -368 -372 -374 -373 -372 -369 -376 -366 -363 ...
##  $ magnet_arm_y        : int  337 344 344 337 336 338 341 334 339 343 ...
##  $ magnet_arm_z        : int  513 513 512 506 509 510 518 516 509 520 ...
##  $ roll_dumbbell       : num  13.1 12.9 13.4 13.4 13.1 ...
##  $ pitch_dumbbell      : num  -70.6 -70.3 -70.4 -70.4 -70.2 ...
##  $ yaw_dumbbell        : num  -84.7 -85.1 -84.9 -84.9 -85.1 ...
##  $ total_accel_dumbbell: int  37 37 37 37 37 37 37 37 37 37 ...
##  $ gyros_dumbbell_x    : num  0 0 0 0 0 0 0 0 0 0 ...
##  $ gyros_dumbbell_y    : num  -0.02 -0.02 -0.02 -0.02 -0.02 -0.02 -0.02 -0.02 -0.02 -0.02 ...
##  $ gyros_dumbbell_z    : num  0 0 -0.02 0 0 0 0 0 0 0 ...
##  $ accel_dumbbell_x    : int  -233 -232 -232 -233 -232 -234 -232 -235 -233 -233 ...
##  $ accel_dumbbell_y    : int  47 46 48 48 47 46 47 48 47 47 ...
##  $ accel_dumbbell_z    : int  -269 -270 -269 -270 -270 -272 -269 -270 -269 -270 ...
##  $ magnet_dumbbell_x   : int  -555 -561 -552 -554 -551 -555 -549 -558 -564 -554 ...
##  $ magnet_dumbbell_y   : int  296 298 303 292 295 300 292 291 299 291 ...
##  $ magnet_dumbbell_z   : num  -64 -63 -60 -68 -70 -74 -65 -69 -64 -65 ...
##  $ roll_forearm        : num  28.3 28.3 28.1 28 27.9 27.8 27.7 27.7 27.6 27.5 ...
##  $ pitch_forearm       : num  -63.9 -63.9 -63.9 -63.9 -63.9 -63.8 -63.8 -63.8 -63.8 -63.8 ...
##  $ yaw_forearm         : num  -153 -152 -152 -152 -152 -152 -152 -152 -152 -152 ...
##  $ total_accel_forearm : int  36 36 36 36 36 36 36 36 36 36 ...
##  $ gyros_forearm_x     : num  0.02 0.03 0.02 0.02 0.02 0.02 0.03 0.02 0.02 0.02 ...
##  $ gyros_forearm_y     : num  0 -0.02 -0.02 0 0 -0.02 0 0 -0.02 0.02 ...
##  $ gyros_forearm_z     : num  -0.02 0 0 -0.02 -0.02 0 -0.02 -0.02 -0.02 -0.03 ...
##  $ accel_forearm_x     : int  192 196 189 189 195 193 193 190 193 191 ...
##  $ accel_forearm_y     : int  203 204 206 206 205 205 204 205 205 203 ...
##  $ accel_forearm_z     : int  -216 -213 -214 -214 -215 -213 -214 -215 -214 -215 ...
##  $ magnet_forearm_x    : int  -18 -18 -16 -17 -18 -9 -16 -22 -17 -11 ...
##  $ magnet_forearm_y    : num  661 658 658 655 659 660 653 656 657 657 ...
##  $ magnet_forearm_z    : num  473 469 469 473 470 474 476 473 465 478 ...
##  $ classe              : Factor w/ 5 levels "A","B","C","D",..: 1 1 1 1 1 1 1 1 1 1 ...
```
In order to look only at the variables related to movement, the first seven variables are also removed, as they relate to the sequence and subject.

```{r processing4, echo=TRUE, cache=TRUE, results='hide', eval=T}
training = training[,-c(1:7)]
```

##Modeling the data

##Model Building
A model to predict classe using a random forest on the remaining variables was 
built.
```{r model, echo=TRUE, cache=TRUE, results='hide', eval=T}
model = train(classe~., method="rf", data=training)
saveRDS(model, "rfmodel.RDS")
model = readRDS("rfmodel.RDS")
```

##Model Evaluation
The model was trained on the training data, and then used to test the accuracy 
using the testing data initially omitted. Accuracy is defined as the percentage 
of correct predictions from the model.
```{r model2, echo=TRUE, cache=TRUE, results='hide', eval=T}
mean(predict(model, testing) == testing$classe) * 100
## [1] 99.8
```
The model is 99.8% accurate on the testing data.

##Conclusion

Based on the model built to predict exercise form, the out-of-sample error is 
estimated as .2%. This result supports the model which uses machine learning to 
detect bad exercise form. However, this model may not truly predict form in real 
life, as it simply measures on select movements which have been carefully 
contrived. With more complex parameters added to the data and measured 
statistics, the model could potentially more closely predict form in a practical 
manner.